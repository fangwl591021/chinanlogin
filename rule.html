<script>
async function saveRules(){
  if(!isAdmin){
    alert('ğŸš« æ‚¨æ²’æœ‰ä¿®æ”¹æ¬Šé™');
    return;
  }

  const body = {
    mode: 'updateRules',   // âœ… æ–°å¢ï¼šæ˜ç¢ºæ¨™ç¤ºæ›´æ–°æ¨¡å¼
    seatLimit: parseInt(document.getElementById('seatLimit').value),
    maxNoShow: parseInt(document.getElementById('maxNoShow').value),
    banWeeks: parseInt(document.getElementById('banWeeks').value),
    tripMode: document.getElementById('tripMode').value,
    updatedBy: currentUserId,
    lastUpdate: new Date().toISOString()
  };

  try{
    const res = await fetch(CONFIG.WORKER_URL + '?mode=updateRules', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(body)
    });
    const json = await res.json();
    if(json.status === 'success'){
      showToast('âœ… å·²æ›´æ–°è¨­å®š');
      await loadRules();
    }else{
      alert('âŒ æ›´æ–°å¤±æ•—ï¼š' + (json.message || 'æœªçŸ¥éŒ¯èª¤'));
      console.log('GASå›å‚³ï¼š', json);
    }
  }catch(e){
    alert('âŒ æ›´æ–°éŒ¯èª¤ï¼š' + e.message);
  }
}
</script>
