<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ç©¿å±±ç”²å°ˆè»Šé ç´„</title>
<style>
body { font-family:'Microsoft JhengHei'; background:#f5f6f7; color:#333; padding:20px; }
.container { max-width:600px; margin:auto; background:#fff; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
h2 { text-align:center; color:#2e7d32; }
#userInfo { background:#e8f5e9; border:1px solid #81c784; padding:10px; border-radius:8px; margin-bottom:10px; }
button { width:100%; padding:12px; border:none; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer; margin-top:10px; }
#submitBtn { background:#2e7d32; color:white; }
.success { color:#2e7d32; background:#e8f5e9; padding:10px; border-radius:8px; }
.error { color:#c62828; background:#ffebee; padding:10px; border-radius:8px; }
</style>
</head>
<body>
<div class="container">
  <h2>ğŸšŒ ç©¿å±±ç”²å°ˆè»Šé ç´„</h2>
  <div id="userInfo">è¼‰å…¥ä¸­...</div>

  <label>é¸æ“‡æ—¥æœŸ</label>
  <input type="date" id="date">

  <label>é¸æ“‡ç­æ¬¡</label>
  <select id="route">
    <option value="">è«‹é¸æ“‡</option>
    <option value="A1">A1ï½œ22:00â€“23:00 æš¨å¤§â†’åŸ”é‡Œç¸½ç«™</option>
    <option value="B1">B1ï½œ22:30â€“23:30 åŸ”é‡Œç¸½ç«™â†’æš¨å¤§</option>
  </select>

  <label>ä¸‹è»Šç«™</label>
  <input id="stop" placeholder="è«‹è¼¸å…¥ä¸‹è»Šç«™">

  <button id="submitBtn">é€å‡ºé ç´„</button>
  <div id="msg"></div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwzV2t-w-jXsgpAFBQR7sGEP4ycpO9ML2bXs-IEutNkIoYJ6Qsf69mihgJMTKVnqVMk5g/exec';
const url = new URL(window.location.href);
const UID = url.searchParams.get('uid');

if (!UID) {
  document.body.innerHTML = '<h3 style="color:red;text-align:center;">è«‹å…ˆç™»å…¥å†é€²å…¥é ç´„é </h3>';
} else {
  loadUserInfo();
}

async function loadUserInfo(){
  const res = await fetch(`${API_URL}?action=checkUser&lineUserId=${UID}`);
  const data = await res.json();
  if (data.isRegistered) {
    document.getElementById('userInfo').innerHTML = `ğŸ‘¤ ${data.userName}`;
  } else {
    document.getElementById('userInfo').innerHTML = `<span class="error">æŸ¥ç„¡æœƒå“¡è³‡æ–™</span>`;
  }
}

document.getElementById('submitBtn').onclick = async ()=>{
  const d = {
    action:'submitReservation',
    lineUserId: UID,
    date: document.getElementById('date').value,
    route: document.getElementById('route').value,
    stop: document.getElementById('stop').value
  };
  if (!d.date || !d.route || !d.stop) {
    showMsg('âŒ è«‹å®Œæ•´å¡«å¯«é ç´„è³‡æ–™','error'); return;
  }
  const res = await fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(d)
  });
  const data = await res.json();
  if (data.success) showMsg('âœ… é ç´„æˆåŠŸ','success');
  else showMsg('âŒ é ç´„å¤±æ•—ï¼š' + data.message,'error');
};

function showMsg(t,c){document.getElementById('msg').innerHTML=`<div class="${c}">${t}</div>`;}
</script>
</body>
</html>
