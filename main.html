<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç©¿å±±ç”²å°ˆè»Šé ç´„ Pangolin Shuttle Reservation</title>

  <style>
/* === [MODULE: CALENDAR STYLES v2 é’ç¶ ä¸»é¡Œ] START === */
body { font-family: system-ui, sans-serif; background:#f5f6f7; margin:0; padding:0; }
header { background:#27ACB2; color:#fff; text-align:center; padding:15px; font-size:22px; font-weight:bold; line-height: 1.3; }
.en-text { display: block; font-size: 14px; color: #d4f2f3; margin-top: 2px; }

/* æ‰“é–‹æœˆæ›†æŒ‰éˆ• */
#calendarBtn { width:calc(100% - 32px); background:#27ACB2; color:#fff; border:none; padding:12px; border-radius:6px; font-size:16px; font-weight:bold; margin:10px 16px; cursor:pointer; position: relative; transition: background 0.2s; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }
#calendarBtn:hover { background:#1f8f93; }

/* æ—¥æ›†ä¸»å®¹å™¨ */
#calendarContainer { background: #ffffff; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #d3efef; margin: 10px 16px; }

/* æœˆä»½æ¨™é¡Œåˆ— */
#calendarTitle { background: #1f8f93; color: #ffffff; padding: 10px 0; border-radius: 8px; text-align: center; font-weight: bold; font-size: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); letter-spacing: 0.5px; margin-bottom: 8px; }

/* ä¸Šä¸‹æœˆæŒ‰éˆ• */
.small-green-btn { background: #27ACB2; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; padding: 8px 14px; font-size: 14px; transition: all 0.2s ease; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.small-green-btn:hover { background: #1f8f93; transform: translateY(-1px); }

/* æ˜ŸæœŸæ¨™é ­ */
.calendar-header { background: #f0fafa; color: #27ACB2; font-weight: bold; border-radius: 4px; padding: 6px 0; font-size: 13px; }

/* æ—¥æœŸæ ¼æ¨£å¼ */
.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center; font-size: 13px; margin-bottom: 20px; }
.calendar-day { background: #fff; color: #333; border: 1px solid #e0e0e0; border-radius: 6px; padding: 8px 0; text-align: center; cursor: pointer; transition: all 0.25s ease; }
.calendar-day:hover { background: #e9fafa; color: #27ACB2; border-color: #a8e2e4; box-shadow: 0 0 6px rgba(39,172,178,0.25); }
.calendar-day.selected { background: #27ACB2; color: #fff; font-weight: bold; box-shadow: 0 0 6px rgba(0,0,0,0.25); }
.calendar-day.past, .calendar-day.disabled { background: #f5f5f5; color: #aaa; cursor: not-allowed; }
.calendar-day.today { background: #1f8f93; color: #fff; font-weight: bold; box-shadow: 0 0 6px rgba(0,0,0,0.2); }

/* æç¤ºæ¡† */
.notice.success { background: #e9fafa; color: #1f8f93; border: 1px solid #a8e2e4; padding: 10px 16px; border-radius: 6px; margin: 10px 16px; }
.notice.error { background: #fef2f2; color: #c62828; border: 1px solid #f5c2c7; padding: 10px 16px; border-radius: 6px; margin: 10px 16px; }

.route-btn.selected { background:#27ACB2; color:white; }
.submit-btn { background:#27ACB2; }
.submit-btn:hover { background:#1f8f93; }
/* === [MODULE: CALENDAR STYLES v2 é’ç¶ ä¸»é¡Œ] END === */
  </style>
</head>

<body>
<!-- === [MODULE: PAGE HEADER] START === -->
<header>
  ç©¿å±±ç”²å°ˆè»Šé ç´„
  <span class="en-text">Pangolin Shuttle Reservation</span>
</header>
<!-- === [MODULE: PAGE HEADER] END === -->

<!-- === [MODULE: CALENDAR CONTROL BAR] START === -->
<div style="display:flex;justify-content:space-between;align-items:center;margin:10px 16px;">
  <button class="small-green-btn" onclick="changeMonth(-1)">â—€ ä¸Šå€‹æœˆ<br><span class="en-text">Prev</span></button>
  <h3 id="calendarTitle">2025å¹´ 10æœˆ<br><small class="en-text">October</small></h3>
  <button class="small-green-btn" onclick="changeMonth(1)">ä¸‹å€‹æœˆ â–¶<br><span class="en-text">Next</span></button>
</div>
<!-- === [MODULE: CALENDAR CONTROL BAR] END === -->

<div id="calendarContainer">
  <div class="calendar" id="calendar"></div>
</div>

<button id="calendarBtn" onclick="toggleCalendar()">ğŸ“… æ‰“é–‹æœˆæ›†<span class="en-text">Open Calendar</span></button>

<div class="notice success" id="statusMsg" style="display:none;"></div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
const WORKER_URL = 'https://delicate-math-7e61.fangwl591021.workers.dev/';

/* === [MODULE: TOGGLE CALENDAR FUNCTION] START === */
async function toggleCalendar() {
  const btn = document.getElementById('calendarBtn');
  const container = document.getElementById('calendarContainer');
  const msg = document.getElementById('statusMsg');

  if (container.style.display === 'none' || container.style.display === '') {
    btn.innerHTML = 'â³ è¼‰å…¥ä¸­...<span class="en-text">Loading...</span>';
    btn.disabled = true;

    await new Promise(r => setTimeout(r, 400)); // æ¨¡æ“¬è¼‰å…¥
    renderCalendar();

    container.style.display = 'block';
    btn.disabled = false;
    btn.innerHTML = 'ğŸ“… é—œé–‰æœˆæ›†<span class="en-text">Close Calendar</span>';
    msg.style.display = 'block';
    msg.className = 'notice success';
    msg.innerHTML = 'âœ… æœˆæ›†å·²é–‹å•Ÿ<br><span class="en-text">Calendar opened</span>';
  } else {
    container.style.display = 'none';
    btn.innerHTML = 'ğŸ“… æ‰“é–‹æœˆæ›†<span class="en-text">Open Calendar</span>';
    msg.style.display = 'none';
  }
}
/* === [MODULE: TOGGLE CALENDAR FUNCTION] END === */

/* === [MODULE: RENDER CALENDAR FUNCTION] START === */
function renderCalendar() {
  const cal = document.getElementById('calendar');
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startWeekday = firstDay.getDay();
  const daysInMonth = lastDay.getDate();

  let html = '';
  const weekZh = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
  const weekEn = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  weekZh.forEach((d,i) => {
    html += `<div class="calendar-header">${d}<br><small>${weekEn[i]}</small></div>`;
  });

  for(let i=0;i<startWeekday;i++) html += `<div class="calendar-day other-month"></div>`;
  for(let d=1; d<=daysInMonth; d++){
    html += `<div class="calendar-day">${d}</div>`;
  }

  cal.innerHTML = html;
}
/* === [MODULE: RENDER CALENDAR FUNCTION] END === */

/* === [MODULE: MAIN INIT FUNCTION] START === */
window.addEventListener('load', async () => {
  console.log('ğŸš€ åˆå§‹åŒ– LIFF ä¸­...');
  try {
    await liff.init({ liffId: "2006590746-KJodGOda" });
    if (!liff.isLoggedIn()) { liff.login(); return; }
    const profile = await liff.getProfile();
    console.log('âœ… ä½¿ç”¨è€…ç™»å…¥æˆåŠŸ:', profile.displayName);
  } catch (e) {
    console.error('LIFF åˆå§‹åŒ–å¤±æ•—', e);
  }
});
/* === [MODULE: MAIN INIT FUNCTION] END === */
</script>
</body>
</html>
