<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç©¿å±±ç”²å°ˆè»Š - å¸æ©Ÿæ ¸éŠ·ç³»çµ±</title>
<style>
/* ä¿æŒç›¸åŒçš„ CSS æ¨£å¼ */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Microsoft JhengHei',sans-serif;}
body{background:#f5f6f7;color:#333;line-height:1.6;width:100vw;overflow-x:hidden;}
.container{width:100%;margin:0;padding:12px;box-sizing:border-box;}
.header{background:#3c8050;color:white;padding:15px;border-radius:12px;margin-bottom:15px;text-align:center;}
.header h1{font-size:22px;margin-bottom:5px;}
.header p{font-size:13px;opacity:0.9;}
.calendar-section{background:white;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.calendar-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;gap:8px;}
.calendar-nav button{background:#3c8050;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:12px;flex:0 0 auto;}
.calendar-nav button:hover{background:#2f6842;}
.calendar-title{text-align:center;font-size:16px;font-weight:bold;flex:1;white-space:nowrap;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.day-header{padding:8px 0;font-weight:bold;background:#27ACB2;color:white;text-align:center;border-radius:4px;font-size:11px;}
.day-cell{padding:8px 0;background:white;border:1px solid #e0e0e0;text-align:center;border-radius:6px;cursor:pointer;transition:all .2s;font-size:12px;aspect-ratio:1;}
.day-cell:hover{background:#eaf5ea;border-color:#3c8050;}
.day-cell.disabled{background:#f8f9fa;color:#999;cursor:not-allowed;}
.day-cell.past{background:#f5f5f5;color:#ccc;cursor:not-allowed;}
.day-cell.selected{background:#3c8050;color:white;font-weight:bold;}
.day-cell.other-month{color:#ccc;background:#f8f9fa;}
.route-map-section {background: white;border-radius: 12px;padding: 15px;margin-bottom: 15px;box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
.route-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 15px;}
.route-header h2 {color: #2e7d32;margin: 0;font-size: 16px;}
.route-header button {background: #3c8050;color: white;border: none;padding: 6px 10px;border-radius: 6px;cursor: pointer;font-size: 12px;}
.route-header button:hover {background: #2f6842;}
.route-line {margin-bottom: 20px;}
.route-line h3 {font-size: 15px;color: #333;margin-bottom: 8px;}
.stops {display: flex;flex-wrap: wrap;align-items: center;gap: 4px;line-height: 1.8;}
.stops span,.stops strong {font-size: 13px;}
.stops strong {color: #2e7d32;font-weight: bold;}
.stops .arrow {color: #888;font-size: 12px;}
.a-line {border-left: 4px solid #2e7d32;padding-left: 8px;}
.b-line {border-left: 4px solid #1565c0;padding-left: 8px;}
.checkin-section{background:white;border-radius:12px;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.checkin-section h2{margin-bottom:12px;color:#333;border-bottom:2px solid #3c8050;padding-bottom:8px;font-size:16px;}
.reservation-table{width:100%;border-collapse:collapse;}
.table-header{background:#3c8050;color:white;font-weight:bold;text-align:left;}
.table-header th{padding:10px 8px;font-size:12px;border:1px solid #2f6842;}
.table-row{border-bottom:1px solid #e0e0e0;}
.table-row:hover{background:#f8faf8;}
.table-row td{padding:10px 6px;border:1px solid #e0e0e0;font-size:12px;word-break:break-word;}
.stop-cell{word-break:break-word;line-height:1.4;}
.passenger-name{color:#0066cc;cursor:pointer;font-weight:600;text-decoration:underline;}
.passenger-name:hover{color:#0052a3;}
.checkin-btn{background:#3c8050;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;white-space:nowrap;}
.checkin-btn:hover{background:#2f6842;}
.checkin-btn:disabled{background:#ccc;cursor:not-allowed;}
.no-data{text-align:center;color:#999;padding:30px 12px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;}
.modal.active{display:flex;}
.modal-content{background:white;border-radius:12px;padding:24px;max-width:90%;width:100%;max-width:380px;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
.modal-header{font-size:18px;font-weight:bold;margin-bottom:20px;border-bottom:2px solid #3c8050;padding-bottom:10px;}
.modal-body{margin-bottom:20px;line-height:2;}
.modal-body div{margin-bottom:12px;}
.modal-label{color:#666;font-size:12px;}
.modal-value{color:#333;font-weight:600;font-size:14px;}
.phone-link{color:#0066cc;text-decoration:none;font-weight:600;cursor:pointer;}
.modal-close{background:#e0e0e0;color:#333;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:600;width:100%;}
.modal-close:hover{background:#ccc;}
</style>
</head>

<body>
<div class="container">
  <!-- é ‚éƒ¨ -->
  <div class="header">
    <h1>ğŸšŒ ç©¿å±±ç”²å°ˆè»Šæ ¸éŠ·ç³»çµ±</h1>
    <p>å¸æ©Ÿç°½åˆ°æ ¸éŠ·ä½œæ¥­</p>
  </div>

  <!-- æœˆæ›† -->
  <div class="calendar-section">
    <div class="calendar-nav">
      <button id="prev-month">â—€</button>
      <h2 class="calendar-title" id="current-month">2025å¹´10æœˆ</h2>
      <button id="next-month">â–¶</button>
      <button id="toggle-calendar">æ”¶åˆ</button>
    </div>
    <div class="calendar-grid" id="calendar-grid" style="display:none;"></div>
  </div>

  <!-- è¡Œè»Šè·¯ç·šåœ– -->
  <div class="route-map-section">
    <div class="route-header">
      <h2>ğŸš è¡Œè»Šè·¯ç·šç¤ºæ„åœ–</h2>
      <button id="toggle-route">å±•é–‹</button>
    </div>

    <div id="route-content" style="display:none;">
      <div class="route-line a-line">
        <h3>ğŸ…°ï¸ Aç·šï¼ˆæš¨å¤§ â†’ åŸ”é‡Œç¸½ç«™ï¼‰</h3>
        <div class="stops">
          <span>è¡Œæ”¿å¤§æ¨“</span><span class="arrow">â”</span>
          <span>ä¸­é¤å»³</span><span class="arrow">â”</span>
          <span>ç§‘æŠ€å­¸é™¢</span><span class="arrow">â”</span>
          <span>å­¸äººæœƒé¤¨</span><span class="arrow">â”</span>
          <span>ä¸­åŸ</span><span class="arrow">â”</span>
          <span>ä¸‹åŸ</span><span class="arrow">â”</span>
          <span>åªé ‚</span><span class="arrow">â”</span>
          <span>æ„›è˜­æ©‹</span><span class="arrow">â”</span>
          <span>å¤§æˆåœ‹å°</span><span class="arrow">â”</span>
          <span>ä¸­å±±å®‰ä¸ƒè¡—å£</span><span class="arrow">â”</span>
          <span>æ¦®æ°‘è¨ºæ‰€</span><span class="arrow">â”</span>
          <strong>åŸ”é‡Œé…’å» </strong><span class="arrow">â”</span>
          <strong>åŸ”é‡Œç¸½ç«™</strong>
        </div>
      </div>

      <div class="route-line b-line">
        <h3>ğŸ…±ï¸ Bç·šï¼ˆåŸ”é‡Œç¸½ç«™ â†’ æš¨å¤§ï¼‰</h3>
        <div class="stops">
          <strong>åŸ”é‡Œç¸½ç«™</strong><span class="arrow">â”</span>
          <strong>åŸ”é‡Œé…’å» </strong><span class="arrow">â”</span>
          <span>æ¦®æ°‘è¨ºæ‰€</span><span class="arrow">â”</span>
          <span>ä¸­å±±å®‰ä¸ƒè¡—å£</span><span class="arrow">â”</span>
          <span>å¤§æˆåœ‹å°</span><span class="arrow">â”</span>
          <span>æ„›è˜­æ©‹</span><span class="arrow">â”</span>
          <span>åªé ‚</span><span class="arrow">â”</span>
          <span>ä¸‹åŸ</span><span class="arrow">â”</span>
          <span>ä¸­åŸ</span><span class="arrow">â”</span>
          <span>å­¸äººæœƒé¤¨</span><span class="arrow">â”</span>
          <span>ç§‘æŠ€å­¸é™¢</span><span class="arrow">â”</span>
          <span>ä¸­é¤å»³</span><span class="arrow">â”</span>
          <strong>è¡Œæ”¿å¤§æ¨“</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- æ ¸éŠ·åˆ—è¡¨ -->
  <div id="checkin-section" class="checkin-section">
    <h2 id="checkin-title">å…¨éƒ¨é ç´„åˆ—è¡¨</h2>
    <table class="reservation-table">
      <thead class="table-header">
        <tr>
          <th style="width:18%;">æ—¥æœŸ</th>
          <th style="width:10%;">ç­æ¬¡</th>
          <th style="width:22%;">å§“å</th>
          <th style="width:20%;">ä¸Šè»Š</th>
          <th style="width:20%;">ä¸‹è»Š</th>
          <th style="width:10%;">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="reservation-list"></tbody>
    </table>
  </div>
</div>

<!-- è©³ç´°è³‡è¨Šå½ˆå‡ºçª— -->
<div id="infoModal" class="modal">
  <div class="modal-content">
    <div class="modal-header" id="modal-name"></div>
    <div class="modal-body">
      <div><div class="modal-label">ç§‘ç³»</div><div class="modal-value" id="modal-department"></div></div>
      <div><div class="modal-label">é›»è©±</div><div class="modal-value"><a id="modal-phone" href="#" class="phone-link"></a></div></div>
    </div>
    <button class="modal-close" onclick="closeModal()">é—œé–‰</button>
  </div>
</div>

<script>
const WORKER_URL = 'https://delicate-math-7e61.fangwl591021.workers.dev/';
const GAS_URL = 'https://script.google.com/macros/s/AKfycbza2qFcrQt1PS6Y4p4u2gSXovvFxWecEjjIh5ov1cIk_65zgdFJA0xjVuS3qr7WvlgAzA/exec';

let currentDate = new Date();
let currentMonth = currentDate.getMonth();
let currentYear = currentDate.getFullYear();
let selectedDate = null;
let allReservations = [];

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('prev-month').onclick = () => changeMonth(-1);
  document.getElementById('next-month').onclick = () => changeMonth(1);
  document.getElementById('toggle-calendar').onclick = toggleCalendar;
  document.getElementById('toggle-route').onclick = toggleRoute;
  const modal = document.getElementById('infoModal');
  if (modal) modal.addEventListener('click', (e) => { if (e.target.id === 'infoModal') closeModal(); });
  initializeSystem();
});

async function initializeSystem() {
  await loadAllReservations();
  renderCalendar();
  showAllReservations();
}

async function loadAllReservations() {
  try {
    const res = await fetch(`${WORKER_URL}?mode=reservations`);
    const result = await res.json();
    console.log('API è¿”å›çš„å®Œæ•´è³‡æ–™:', result); // èª¿è©¦ç”¨
    
    let reservations = result.reservations || [];
    
    // éæ¿¾æ‰å·²å–æ¶ˆçš„é ç´„
    reservations = reservations.filter(r => r.status !== 'å·²å–æ¶ˆ');
    
    // è½‰æ›è³‡æ–™çµæ§‹ï¼Œè™•ç†ä¸åŒçš„æ¬„ä½åç¨±
    allReservations = reservations.map(reservation => {
      // èª¿è©¦ç”¨ï¼šé¡¯ç¤ºæ¯å€‹é ç´„çš„å®Œæ•´çµæ§‹
      console.log('å–®å€‹é ç´„å®Œæ•´è³‡æ–™:', JSON.stringify(reservation, null, 2));
      
      // æª¢æŸ¥æ‰€æœ‰å¯èƒ½çš„æ¬„ä½åç¨±
      const allKeys = Object.keys(reservation);
      console.log('æ‰€æœ‰æ¬„ä½åç¨±:', allKeys);
      
      // å°‹æ‰¾ä¸Šè»Šç«™é»ç›¸é—œæ¬„ä½
      const fromStopKey = allKeys.find(key => 
        key.includes('ä¸Šè»Š') || 
        key.includes('from') || 
        key.includes('pickup') || 
        key.includes('start') ||
        key.toLowerCase().includes('departure')
      );
      
      // å°‹æ‰¾ä¸‹è»Šç«™é»ç›¸é—œæ¬„ä½
      const toStopKey = allKeys.find(key => 
        key.includes('ä¸‹è»Š') || 
        key.includes('to') || 
        key.includes('dropoff') || 
        key.includes('end') ||
        key.toLowerCase().includes('destination')
      );
      
      // å°‹æ‰¾ç§‘ç³»ç›¸é—œæ¬„ä½
      const departmentKey = allKeys.find(key => 
        key.includes('ç§‘ç³»') || 
        key.includes('department') || 
        key.includes('ç³»æ‰€') ||
        key.includes('major')
      );
      
      // å°‹æ‰¾ç­æ¬¡ç›¸é—œæ¬„ä½
      const routeKey = allKeys.find(key => 
        key.includes('ç­æ¬¡') || 
        key.includes('route') || 
        key.includes('shift') ||
        key.includes('line')
      );
      
      // å°‹æ‰¾æ ¸éŠ·ç‹€æ…‹ç›¸é—œæ¬„ä½
      const checkinKey = allKeys.find(key => 
        key.includes('æ ¸éŠ·') || 
        key.includes('checkin') || 
        key.includes('checked') ||
        key.includes('status')
      );
      
      const fromStop = fromStopKey ? reservation[fromStopKey] : 'æœªæä¾›';
      const toStop = toStopKey ? reservation[toStopKey] : 'æœªæä¾›';
      const department = departmentKey ? reservation[departmentKey] : 'æœªæä¾›';
      const route = routeKey ? reservation[routeKey] : (reservation.shift || '');
      const checkinStatus = checkinKey ? reservation[checkinKey] : 'N';
      
      console.log('æ‰¾åˆ°çš„æ¬„ä½:', { fromStopKey, toStopKey, departmentKey, routeKey, checkinKey });
      console.log('å°æ‡‰çš„å€¼:', { fromStop, toStop, department, route, checkinStatus });
      
      return {
        id: String(reservation.id || reservation._id || ''),
        date: String(reservation.date || reservation.æ—¥æœŸ || ''),
        route: String(route),
        name: String(reservation.name || reservation.å§“å || 'æœªæä¾›'),
        department: String(department),
        studentId: String(reservation.studentId || reservation.å­¸è™Ÿ || ''),
        phone: String(reservation.phone || reservation.é›»è©± || 'æœªæä¾›'),
        fromStop: fromStop,
        toStop: toStop,
        checkinStatus: checkinStatus === 'Y' || checkinStatus === true || checkinStatus === 'å·²æ ¸éŠ·' ? 'Y' : 'N'
      };
    });
    
    console.log('è™•ç†å¾Œçš„é ç´„è³‡æ–™:', allReservations); // èª¿è©¦ç”¨
    
  } catch (e) {
    console.error('è¼‰å…¥å¤±æ•—:', e);
    // å¦‚æœAPIå¤±æ•—ï¼Œä½¿ç”¨ç¤ºä¾‹æ•¸æ“š
    allReservations = getSampleReservations();
  }
}

// ç¤ºä¾‹æ•¸æ“šå‡½æ•¸
function getSampleReservations() {
  return [
    {
      id: "1",
      date: "2025-10-17",
      route: "A1",
      name: "ç‹å­é½Š",
      department: "è³‡è¨Šå·¥ç¨‹å­¸ç³»",
      studentId: "D1234567",
      phone: "0912345678",
      fromStop: "è¡Œæ”¿å¤§æ¨“",
      toStop: "åŸ”é‡Œç¸½ç«™",
      checkinStatus: "Y"
    },
    {
      id: "2",
      date: "2025-10-17",
      route: "A1",
      name: "æ–¹è¬éš†",
      department: "ä¼æ¥­ç®¡ç†å­¸ç³»",
      studentId: "D7654321",
      phone: "0987654321",
      fromStop: "ç§‘æŠ€å­¸é™¢",
      toStop: "åŸ”é‡Œé…’å» ",
      checkinStatus: "Y"
    },
    {
      id: "3",
      date: "2025-10-20",
      route: "A1",
      name: "è”¡å¿—æ˜‡",
      department: "é›»æ©Ÿå·¥ç¨‹å­¸ç³»",
      studentId: "D1122334",
      phone: "0922334455",
      fromStop: "å­¸äººæœƒé¤¨",
      toStop: "æ¦®æ°‘è¨ºæ‰€",
      checkinStatus: "N"
    }
  ];
}

function renderCalendar() {
  const grid = document.getElementById('calendar-grid');
  grid.innerHTML = '';
  ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].forEach(d => {
    const h = document.createElement('div');
    h.className = 'day-header';
    h.textContent = d;
    grid.appendChild(h);
  });
  const first = new Date(currentYear, currentMonth, 1);
  const last = new Date(currentYear, currentMonth + 1, 0);
  const offset = first.getDay();
  const today = formatDate(new Date());
  for (let i=offset-1;i>=0;i--){const d=document.createElement('div');d.className='day-cell other-month';grid.appendChild(d);}
  for (let i=1;i<=last.getDate();i++){
    const d=document.createElement('div');d.className='day-cell';
    const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
    const isPast=dateStr<today;
    if(isPast)d.classList.add('past');else d.onclick=()=>selectDate(dateStr);
    if(dateStr===selectedDate)d.classList.add('selected');
    d.textContent=i;grid.appendChild(d);
  }
  const totalCells=42;const nextMonthDays=totalCells-(offset+last.getDate());
  for(let i=1;i<=nextMonthDays;i++){const d=document.createElement('div');d.className='day-cell other-month';grid.appendChild(d);}
  document.getElementById('current-month').textContent=`${currentYear}å¹´${currentMonth+1}æœˆ`;
}

async function selectDate(dateStr){selectedDate=dateStr;renderCalendar();showCheckinList();}
function showCheckinList(){
  if(!selectedDate)return;
  const tbody=document.getElementById('reservation-list');
  tbody.innerHTML='';
  const routes=['A1','B1','A2','B2'];
  const filtered=allReservations.filter(r=>r.date?.startsWith(selectedDate))
    .sort((a,b)=>routes.indexOf(a.route)-routes.indexOf(b.route));
  if(filtered.length===0){tbody.innerHTML='<tr><td colspan="6" class="no-data">æ­¤æ—¥æœŸç„¡é ç´„</td></tr>';document.getElementById('checkin-title').textContent=`${selectedDate} æ ¸éŠ·åˆ—è¡¨`;return;}
  renderReservationRows(filtered,`${selectedDate} æ ¸éŠ·åˆ—è¡¨ (å…± ${filtered.length} ç­†)`);
}
function showAllReservations(){
  const tbody=document.getElementById('reservation-list');
  tbody.innerHTML='';
  const routes=['A1','B1','A2','B2'];
  const sorted=[...allReservations].sort((a,b)=>{
    const dateCompare=(a.date||'').localeCompare(b.date||'');
    if(dateCompare!==0)return dateCompare;
    return routes.indexOf(a.route)-routes.indexOf(b.route);
  });
  if(sorted.length===0){tbody.innerHTML='<tr><td colspan="6" class="no-data">æš«ç„¡é ç´„</td></tr>';return;}
  renderReservationRows(sorted,`å…¨éƒ¨é ç´„åˆ—è¡¨ (å…± ${sorted.length} ç­†)`);
}

// å®‰å…¨å­—ä¸²è™•ç†å‡½æ•¸
function escapeString(str) {
  if (typeof str !== 'string') {
    str = String(str || '');
  }
  return str
    .replace(/'/g, "\\'")
    .replace(/"/g, '\\"')
    .replace(/`/g, '\\`')
    .replace(/\n/g, '\\n')
    .replace(/\r/g, '\\r');
}

function renderReservationRows(filtered, title) {
  const tbody = document.getElementById('reservation-list');
  tbody.innerHTML = '';
  
  filtered.forEach(r => {
    const tr = document.createElement('tr');
    tr.className = 'table-row';
    const isCheckedIn = r.checkinStatus === 'Y';
    
    // ä½¿ç”¨å®‰å…¨çš„å­—ä¸²è™•ç†
    const safeName = escapeString(r.name);
    const safeDepartment = escapeString(r.department);
    const safePhone = escapeString(r.phone);
    const safeDate = r.date ? r.date.split('T')[0] : '';
    const safeFromStop = r.fromStop || 'æœªæä¾›';
    const safeToStop = r.toStop || 'æœªæä¾›';
    const safeRoute = r.route || '';
    const safeId = r.id || '';
    
    tr.innerHTML = `
      <td>${safeDate}</td>
      <td><strong>${safeRoute}</strong></td>
      <td><span class="passenger-name" onclick="showModal('${safeName}', '${safeDepartment}', '${safePhone}')">${r.name}</span></td>
      <td class="stop-cell">${safeFromStop}</td>
      <td class="stop-cell">${safeToStop}</td>
      <td>${isCheckedIn ? '<button class="checkin-btn" disabled>âœ…</button>' : `<button class="checkin-btn" onclick="confirmCheckin('${safeId}')">æ ¸éŠ·</button>`}</td>`;
    tbody.appendChild(tr);
  });
  
  document.getElementById('checkin-title').textContent = title;
}

function showModal(name, department, phone) {
  document.getElementById('modal-name').textContent = name;
  document.getElementById('modal-department').textContent = department;
  
  const phoneLink = document.getElementById('modal-phone');
  if (phone && phone !== 'æœªæä¾›') {
    phoneLink.href = `tel:${phone}`;
    phoneLink.textContent = phone;
  } else {
    phoneLink.textContent = 'æœªæä¾›';
    phoneLink.href = '#';
    phoneLink.onclick = (e) => e.preventDefault();
  }
  
  document.getElementById('infoModal').classList.add('active');
}

function closeModal(){document.getElementById('infoModal').classList.remove('active');}
async function confirmCheckin(id){
  if(!confirm('ç¢ºèªæ­¤ä¹˜å®¢å·²æ ¸éŠ·ï¼Ÿ'))return;
  try{
    const res=await fetch(`${GAS_URL}?mode=confirmCheckin&id=${encodeURIComponent(id)}`);
    const result=await res.json();
    if(result.status==='success'){
      alert('âœ… æ ¸éŠ·æˆåŠŸ');
      const reservation = allReservations.find(r=>r.id===id);
      if(reservation) reservation.checkinStatus='Y';
      selectedDate?showCheckinList():showAllReservations();
    }
    else alert('âŒ æ ¸éŠ·å¤±æ•—ï¼š'+(result.message||'è«‹ç¨å¾Œå†è©¦'));
  }catch(e){alert('âŒ éŒ¯èª¤ï¼š'+e.message);}
}
async function changeMonth(d){
  currentMonth+=d;if(currentMonth<0){currentMonth=11;currentYear--;}else if(currentMonth>11){currentMonth=0;currentYear++;}
  selectedDate=null;await loadAllReservations();renderCalendar();showAllReservations();
}
function toggleCalendar(){
  const grid=document.getElementById('calendar-grid');
  const btn=document.getElementById('toggle-calendar');
  const isHidden=grid.style.display==='none';
  grid.style.display=isHidden?'grid':'none';
  btn.textContent=isHidden?'æ”¶åˆ':'å±•é–‹';
}
function toggleRoute(){
  const content=document.getElementById('route-content');
  const btn=document.getElementById('toggle-route');
  const isHidden=content.style.display==='none';
  content.style.display=isHidden?'block':'none';
  btn.textContent=isHidden?'æ”¶åˆ':'å±•é–‹';
}
function formatDate(date){return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;}
</script>
</body>
</html>
