<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç©¿å±±ç”²å°ˆè»Š - ç®¡ç†å¾Œå°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-gray-50">
  <nav class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <i class="fas fa-bus text-2xl"></i>
        <div>
          <h1 class="text-xl font-bold">æš¨å¤§æ¥é§è»Šç®¡ç†å¾Œå°</h1>
          <p class="text-sm text-purple-200">ç©¿å±±ç”²å°ˆè»Šé ç´„ç³»çµ±</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <span id="currentTime" class="text-sm"></span>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto p-6">
    <!-- çµ±è¨ˆå¡ç‰‡ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-md p-6 flex justify-between items-center">
        <div>
          <p class="text-gray-500 text-sm">è¨»å†Šæœƒå“¡</p>
          <p id="totalUsers" class="text-3xl font-bold text-gray-800">0</p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
          <i class="fas fa-users text-blue-600 text-xl"></i>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-md p-6 flex justify-between items-center">
        <div>
          <p class="text-gray-500 text-sm">ä»Šæ—¥é ç´„</p>
          <p id="todayBookings" class="text-3xl font-bold text-gray-800">0</p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
          <i class="fas fa-calendar-check text-green-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- å³æ™‚ç­æ¬¡ -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-blue-50 rounded-lg p-4 text-center"><p>A1</p><p id="a1Count" class="text-2xl font-bold">0/6</p></div>
      <div class="bg-green-50 rounded-lg p-4 text-center"><p>B1</p><p id="b1Count" class="text-2xl font-bold">0/6</p></div>
      <div class="bg-purple-50 rounded-lg p-4 text-center"><p>A2</p><p id="a2Count" class="text-2xl font-bold">0/6</p></div>
      <div class="bg-orange-50 rounded-lg p-4 text-center"><p>B2</p><p id="b2Count" class="text-2xl font-bold">0/6</p></div>
    </div>

    <!-- æœ€æ–°é ç´„ -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold mb-3">æœ€æ–°é ç´„ç´€éŒ„</h2>
      <div id="realtimeBookings" class="divide-y"></div>
    </div>

    <!-- æœƒå“¡ç®¡ç† -->
    <div class="bg-white rounded-xl shadow-md p-6">
      <h2 class="text-xl font-bold mb-3">æœƒå“¡ç®¡ç†</h2>
      <div class="border rounded-lg overflow-hidden">
        <div class="bg-gray-50 px-4 py-3 border-b grid grid-cols-12 gap-4 text-sm font-semibold">
          <div class="col-span-3">å§“å</div>
          <div class="col-span-2">å­¸è™Ÿ</div>
          <div class="col-span-3">ç§‘ç³»</div>
          <div class="col-span-2">é›»è©±</div>
          <div class="col-span-2">è¨»å†Šæ™‚é–“</div>
        </div>
        <div id="membersTable" class="divide-y max-h-96 overflow-y-auto"></div>
      </div>
    </div>
  </div>

<script>
const GAS_URL = 'ğŸ‘‰ ä½ å‰›å‰›éƒ¨ç½²çš„ GAS ç¶²å€ ğŸ‘ˆ';

async function getMembersData() {
  const res = await fetch(`${GAS_URL}?mode=members`);
  const data = await res.json();
  return data.members || [];
}

async function getBookingsData() {
  const res = await fetch(`${GAS_URL}?mode=bookings`);
  const data = await res.json();
  return data.bookings || [];
}

async function loadRealtimeData() {
  const bookings = await getBookingsData();
  const members = await getMembersData();
  const today = new Date().toISOString().split('T')[0];

  // çµ±è¨ˆ
  const todayBookings = bookings.filter(b => b.date === today);
  document.getElementById('todayBookings').textContent = todayBookings.length;
  document.getElementById('totalUsers').textContent = members.length;

  // ç­æ¬¡
  document.getElementById('a1Count').textContent = `${todayBookings.filter(b => b.route === 'A1').length}/6`;
  document.getElementById('b1Count').textContent = `${todayBookings.filter(b => b.route === 'B1').length}/6`;
  document.getElementById('a2Count').textContent = `${todayBookings.filter(b => b.route === 'A2').length}/6`;
  document.getElementById('b2Count').textContent = `${todayBookings.filter(b => b.route === 'B2').length}/6`;

  // æœ€æ–° 10 ç­†é ç´„
  const recent = todayBookings.slice(-10).reverse();
  const container = document.getElementById('realtimeBookings');
  container.innerHTML = recent.map(b => `
    <div class="px-4 py-3 flex justify-between">
      <div>
        <p class="font-medium">${b.name}</p>
        <p class="text-sm text-gray-500">${b.route} â€¢ ${b.date}</p>
      </div>
      <div>
        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">å·²é ç´„</span>
      </div>
    </div>
  `).join('');
}

async function loadMembersData() {
  const members = await getMembersData();
  const container = document.getElementById('membersTable');
  container.innerHTML = members.map(m => `
    <div class="px-4 py-3 grid grid-cols-12 gap-4 text-sm">
      <div class="col-span-3">${m.name}</div>
      <div class="col-span-2">${m.studentId}</div>
      <div class="col-span-3">${m.department}</div>
      <div class="col-span-2">${m.phone}</div>
      <div class="col-span-2">${m.registerTime}</div>
    </div>
  `).join('');
}

function updateCurrentTime() {
  const now = new Date();
  document.getElementById('currentTime').textContent = now.toLocaleString('zh-TW', { hour12: false });
}

window.addEventListener('load', () => {
  updateCurrentTime();
  setInterval(updateCurrentTime, 1000);
  loadRealtimeData();
  loadMembersData();
  setInterval(loadRealtimeData, 30000);
});
</script>
</body>
</html>
