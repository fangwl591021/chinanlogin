<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç©¿å±±ç”²å°ˆè»Šå¾Œå° v4.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  font-family: "Noto Sans TC", system-ui, sans-serif;
  background: #f8fafc;
  color: #334155;
}
aside { width:260px; background:#fff; border-right:1px solid #e5e7eb; box-shadow:2px 0 6px rgba(0,0,0,0.05); }
.sidebar-btn { display:block; width:100%; padding:14px 18px; text-align:left; border-radius:8px; }
.sidebar-btn:hover { background:#e0f2e9; color:#256d3f; }
.sidebar-btn.active { background:#3c8050; color:white; font-weight:700; }
.card { background:white; border-radius:16px; padding:28px; box-shadow:0 2px 10px rgba(0,0,0,0.08); max-width:1080px; margin:auto; }
.section-title { font-weight:800; font-size:22px; color:#14532d; margin-bottom:16px; display:flex; align-items:center; }
.section-title::before { content:""; display:inline-block; width:8px; height:24px; background:#22c55e; border-radius:3px; margin-right:10px; }
button { font-size:18px; font-weight:600; border-radius:10px; padding:12px 16px; transition:all .2s; }
button:hover { opacity:0.9; }
.notification { position:fixed; top:1rem; right:1rem; z-index:9999; }
</style>
</head>

<body class="flex h-screen overflow-hidden">

<!-- ğŸ§­ å´é‚Šé¸å–® -->
<aside class="flex flex-col">
  <div class="p-5 border-b text-center bg-green-700 text-white">
    <h1 class="text-2xl font-bold">ğŸšŒ å¾Œå°ç®¡ç†</h1>
    <p class="text-sm opacity-90">ç©¿å±±ç”²å°ˆè»Šç³»çµ±</p>
  </div>

  <nav class="flex-1 p-3 space-y-2">
    <button class="sidebar-btn active" data-target="config">ğŸ”§ ç‡Ÿé‹è¨­å®š</button>
    <button class="sidebar-btn" data-target="dashboard">ğŸ“Š å„€è¡¨æ¿</button>
    <button class="sidebar-btn" data-target="reservations">ğŸ§¾ é ç´„æŸ¥è©¢</button>
  </nav>

  <div class="p-4 border-t text-center text-gray-600 text-sm">
    âš™ï¸ <a href="#" id="reloadLink" class="underline">é‡æ–°æ•´ç†è³‡æ–™</a>
  </div>
</aside>

<!-- ğŸ–¥ï¸ ä¸»å…§å®¹ -->
<main class="flex-1 overflow-y-auto p-8">

  <!-- ğŸ”§ ç‡Ÿé‹è¨­å®š -->
  <section id="config" class="card block">
    <h2 class="section-title">ğŸ”§ ç‡Ÿé‹è¨­å®šä¸­å¿ƒ</h2>

    <!-- æ¸¬è©¦æ¨¡å¼ -->
    <div class="mb-4">
      <label class="font-semibold">ç³»çµ±æ¨¡å¼ï¼š</label><br>
      <label class="mr-4"><input type="checkbox" id="testMode" class="mr-1"> å•Ÿç”¨æ¸¬è©¦æ¨¡å¼ï¼ˆä¸å—æˆªæ­¢æ™‚é–“é™åˆ¶ï¼‰</label>
    </div>

    <!-- é ç´„æ¨¡å¼ -->
    <div class="mb-4">
      <label class="font-semibold">é ç´„æ¨¡å¼ï¼š</label><br>
      <label class="mr-6"><input type="radio" name="bookingMode" value="single" checked> å–®ç¨‹åˆ¶ï¼ˆç¦æ­¢åŒç­ä¾†å›ï¼‰</label>
      <label><input type="radio" name="bookingMode" value="roundtrip"> ä¾†å›åˆ¶ï¼ˆè‡ªå‹•é…å°ï¼‰</label>
    </div>

    <!-- ç­æ¬¡å®¹é‡ -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6 text-lg">
      <template id="capacityTemplate">
        <div class="flex flex-col items-center">
          <label class="font-semibold mb-2"></label>
          <input type="number" min="1" max="50" class="border rounded px-3 py-2 w-24 text-center capacity-input">
          <span class="text-sm text-gray-500 mt-1">å¯é ç´„äººæ•¸</span>
        </div>
      </template>
    </div>

    <!-- ç³»çµ±å…¬å‘Š -->
    <div class="mb-4">
      <label class="font-semibold">ç³»çµ±å…¬å‘Šï¼š</label>
      <textarea id="announcement" rows="3" class="w-full border rounded px-3 py-2 text-lg mt-2">æ­¡è¿ä½¿ç”¨ç©¿å±±ç”²å°ˆè»Šé ç´„ç³»çµ±ï¼</textarea>
    </div>

    <!-- æ“ä½œæŒ‰éˆ• -->
    <div class="flex gap-3 mb-6">
      <button id="saveConfig" class="bg-green-600 hover:bg-green-700 text-white flex-1">ğŸ’¾ å„²å­˜è¨­å®š</button>
      <button id="publishConfig" class="bg-blue-600 hover:bg-blue-700 text-white flex-1">ğŸš€ ç™¼ä½ˆè¨­å®š</button>
      <button id="testPush" class="bg-yellow-500 hover:bg-yellow-600 text-white flex-1">ğŸ“¢ æ¨æ’­æ¸¬è©¦</button>
    </div>

    <!-- é è¦½ -->
    <div class="p-4 bg-gray-50 rounded">
      <h3 class="font-semibold text-lg mb-2">ğŸ“± è¨­å®šé è¦½</h3>
      <p>æ¸¬è©¦æ¨¡å¼ï¼š<span id="previewTest" class="text-green-600">é—œé–‰</span></p>
      <p>é ç´„æ¨¡å¼ï¼š<span id="previewMode" class="text-green-600">å–®ç¨‹</span></p>
    </div>
  </section>

  <!-- ğŸ“Š å„€è¡¨æ¿ -->
  <section id="dashboard" class="card hidden">
    <h2 class="section-title">ğŸ“Š ç‡Ÿé‹å„€è¡¨æ¿</h2>
    <p>ï¼ˆæ­¤å€ä¿ç•™ï¼Œæœªè®Šå‹•ï¼‰</p>
  </section>

  <!-- ğŸ§¾ é ç´„æŸ¥è©¢ -->
  <section id="reservations" class="card hidden">
    <h2 class="section-title">ğŸ§¾ é ç´„æŸ¥è©¢</h2>
    <p>ï¼ˆåŒå‰ç‰ˆå…§å®¹ï¼Œæœªæ›´å‹•ï¼‰</p>
  </section>
</main>

<script>
const WORKER_URL = 'https://delicate-math-7e61.fangwl591021.workers.dev/';
let config = {
  testMode: false,
  bookingMode: 'single',
  capacities: { A1:6, A2:6, B1:6, B2:6 },
  announcement: ''
};

// æ›´æ–°é è¦½
function updatePreview() {
  document.getElementById('previewTest').textContent = config.testMode ? 'é–‹å•Ÿ' : 'é—œé–‰';
  document.getElementById('previewMode').textContent = config.bookingMode === 'single' ? 'å–®ç¨‹' : 'ä¾†å›';
}

// å„²å­˜è¨­å®š
function saveConfig() {
  config.testMode = document.getElementById('testMode').checked;
  config.bookingMode = document.querySelector('input[name="bookingMode"]:checked').value;
  config.announcement = document.getElementById('announcement').value;
  localStorage.setItem('pangolinAdminConfig', JSON.stringify(config));
  updatePreview();
  showNote('âœ… è¨­å®šå·²å„²å­˜');
}

// ç™¼ä½ˆè¨­å®š
async function publishConfig() {
  saveConfig();
  try {
    const res = await fetch(WORKER_URL + '?mode=updateRules', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(config)
    });
    showNote(res.ok ? 'ğŸš€ å·²æˆåŠŸç™¼ä½ˆè¨­å®šï¼' : 'âŒ ç™¼ä½ˆå¤±æ•—');
  } catch {
    showNote('âš ï¸ æ¨¡æ“¬ç™¼ä½ˆæˆåŠŸï¼ˆç„¡ç¶²è·¯ï¼‰');
  }
}

// æ¨æ’­æ¸¬è©¦
async function sendTestPush() {
  try {
    const res = await fetch(WORKER_URL + '?mode=testPush');
    showNote(res.ok ? 'ğŸ“¢ æ¸¬è©¦æ¨æ’­å·²ç™¼é€ï¼' : 'âŒ ç™¼é€å¤±æ•—');
  } catch {
    showNote('âš ï¸ æ¨¡æ“¬ç™¼é€æˆåŠŸ');
  }
}

// é€šçŸ¥
function showNote(msg) {
  const div = document.createElement('div');
  div.className = 'notification bg-green-600 text-white p-3 rounded shadow';
  div.textContent = msg;
  document.body.appendChild(div);
  setTimeout(()=>div.remove(),2500);
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded',()=>{
  const saved = localStorage.getItem('pangolinAdminConfig');
  if(saved) config = JSON.parse(saved);
  document.getElementById('testMode').checked = config.testMode;
  document.querySelector(`input[name="bookingMode"][value="${config.bookingMode}"]`).checked = true;
  document.getElementById('announcement').value = config.announcement;
  updatePreview();

  document.getElementById('saveConfig').onclick = saveConfig;
  document.getElementById('publishConfig').onclick = publishConfig;
  document.getElementById('testPush').onclick = sendTestPush;

  document.querySelectorAll('.sidebar-btn').forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll('.sidebar-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const target=btn.dataset.target;
      document.querySelectorAll('main section').forEach(sec=>{
        sec.id===target ? sec.classList.remove('hidden') : sec.classList.add('hidden');
      });
    };
  });
});
</script>
</body>
</html>
