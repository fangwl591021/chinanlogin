<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç©¿å±±ç”²å°ˆè»Šå¾Œå° v3.4.1</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body {
  font-family: "Noto Sans TC", system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}
:root {
  --bg: #f9fafb;
  --text: #1f2937;
  --card-bg: #ffffff;
  --border: #e5e7eb;
}
.dark {
  --bg: #1e293b;
  --text: #e2e8f0;
  --card-bg: #334155;
  --border: #475569;
}
.hidden { display: none; }
.card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 24px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
button {
  border-radius: 10px;
  padding: 12px 16px;
  font-weight: 600;
  transition: all 0.2s;
}
button:active { transform: scale(0.98); }
nav {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: var(--card-bg);
  display: flex;
  justify-content: space-around;
  border-top: 1px solid var(--border);
  padding: 10px 0;
  z-index: 50;
}
nav button {
  flex: 1;
  font-size: 16px;
}
nav button.active {
  color: white;
  background: #3c8050;
}
header {
  background: #3c8050;
  color: white;
  text-align: center;
  padding: 14px 10px;
  position: sticky;
  top: 0;
  z-index: 50;
}
.toggle-theme {
  position: absolute;
  right: 16px;
  top: 14px;
  cursor: pointer;
  font-size: 20px;
}
.toast {
  position: fixed;
  top: 1rem;
  left: 50%;
  transform: translateX(-50%);
  background: #3c8050;
  color: white;
  padding: 10px 18px;
  border-radius: 10px;
  font-weight: 600;
  z-index: 9999;
}
.status-tag {
  padding: 3px 8px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
}
.status-confirmed { background:#d1fae5; color:#065f46; }
.status-cancelled { background:#fecaca; color:#991b1b; }
#loginScreen {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
</style>
</head>

<body class="pb-24">

<!-- ğŸŒ¿ ç™»å…¥ç•«é¢ -->
<div id="loginScreen">
  <h1 class="text-2xl font-bold text-green-700 mb-6">ğŸšŒ ç©¿å±±ç”²å°ˆè»Šå¾Œå°ç³»çµ±</h1>
  <button id="loginBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg text-lg">
    ä½¿ç”¨ LINE ç™»å…¥
  </button>
</div>

<!-- ğŸŒ¿ ç™»å…¥å¾Œä¸»ç•«é¢ -->
<div id="mainApp" class="hidden">

  <header>
    <h1 class="text-xl font-bold">ğŸšŒ ç©¿å±±ç”²å°ˆè»Šå¾Œå°</h1>
    <span class="toggle-theme" id="themeToggle">ğŸŒ</span>
    <div class="text-sm mt-1" id="userInfo">ç™»å…¥ä¸­...</div>
  </header>

  <section id="config" class="card">
    <h2 class="text-xl font-bold mb-3">ğŸ”§ ç‡Ÿé‹è¨­å®š</h2>
    <label class="block font-semibold mb-2">é ç´„æ¨¡å¼ï¼š</label>
    <div class="mb-4">
      <label class="mr-3"><input type="radio" name="mode" value="single" checked> å–®ç¨‹åˆ¶</label>
      <label><input type="radio" name="mode" value="roundtrip"> ä¾†å›åˆ¶</label>
    </div>
    <div class="mb-4">
      <label class="font-semibold">å…¬å‘Šè¨Šæ¯ï¼š</label>
      <textarea id="announcement" rows="3" class="w-full border rounded px-3 py-2 mt-2 text-lg" placeholder="è«‹è¼¸å…¥å…¬å‘Š..."></textarea>
    </div>
    <button id="saveConfig" class="bg-green-600 hover:bg-green-700 text-white w-full text-lg">ğŸ’¾ å„²å­˜è¨­å®š</button>
  </section>

  <section id="reservations" class="card hidden">
    <h2 class="text-xl font-bold mb-3">ğŸ§¾ é ç´„æŸ¥è©¢</h2>
    <div id="reservationList" class="space-y-2 text-base text-gray-700"></div>
  </section>

  <section id="drivers" class="card hidden">
    <h2 class="text-xl font-bold mb-3">ğŸš å¸æ©Ÿæ ¸éŠ·</h2>
    <p>æ­¤åŠŸèƒ½åƒ…é™å¸æ©Ÿæ“ä½œã€‚</p>
    <div id="driverList" class="space-y-2 text-base"></div>
  </section>

  <section id="dashboard" class="card hidden">
    <h2 class="text-xl font-bold mb-3">ğŸ“Š ç‡Ÿé‹å„€è¡¨æ¿</h2>
    <p>ï¼ˆé–‹ç™¼ä¸­ï¼‰</p>
  </section>

  <nav>
    <button data-target="config" class="active">ğŸ”§ è¨­å®š</button>
    <button data-target="reservations">ğŸ§¾ æŸ¥è©¢</button>
    <button data-target="drivers">ğŸš æ ¸éŠ·</button>
    <button data-target="dashboard">ğŸ“Š å„€è¡¨æ¿</button>
    <button id="logoutBtn" class="bg-red-600 text-white">ç™»å‡º</button>
  </nav>
</div>

<script>
const LIFF_ID = "2006590746-KJodGOda";
let userProfile = null;
let userRole = "user";

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) {
    document.getElementById("loginScreen").classList.remove("hidden");
    return;
  }
  showMainApp();
}

document.getElementById("loginBtn").addEventListener("click", () => {
  liff.login();
});

async function showMainApp() {
  userProfile = await liff.getProfile();
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainApp").classList.remove("hidden");
  const name = userProfile.displayName || "ä½¿ç”¨è€…";
  document.getElementById("userInfo").textContent = `${name}ï¼ˆ${userRole}ï¼‰`;
  showToast(`æ­¡è¿å›ä¾†ï¼Œ${name}ï¼`);
  loadTheme();
  loadSection("config");
  renderReservations();
}

// ğŸ”˜ ç™»å‡º
document.getElementById("logoutBtn").addEventListener("click", () => {
  liff.logout();
  localStorage.clear();
  document.getElementById("mainApp").classList.add("hidden");
  document.getElementById("loginScreen").classList.remove("hidden");
});

// ğŸŒ™ ä¸»é¡Œåˆ‡æ›
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  localStorage.setItem("darkMode", isDark ? "1" : "0");
  themeToggle.textContent = isDark ? "ğŸŒ™" : "ğŸŒ";
});
function loadTheme() {
  const dark = localStorage.getItem("darkMode") === "1";
  if (dark) {
    document.body.classList.add("dark");
    themeToggle.textContent = "ğŸŒ™";
  }
}

// æ¨¡æ“¬è³‡æ–™
const demoReservations = [
  { name:"å¼µå°æ˜", date:"2025-10-19", route:"A1", status:"å·²ç¢ºèª" },
  { name:"ç‹å°ç¾", date:"2025-10-20", route:"B2", status:"å·²ç¢ºèª" },
  { name:"æ—å¤§è¯", date:"2025-10-21", route:"A2", status:"å·²å–æ¶ˆ" }
];

// ğŸ§¾ æ¸²æŸ“é ç´„
function renderReservations() {
  const list = document.getElementById("reservationList");
  list.innerHTML = "";
  demoReservations.forEach((r, i) => {
    const div = document.createElement("div");
    div.className = "flex justify-between items-center border-b border-gray-300 py-2";
    const statusClass = r.status === "å·²å–æ¶ˆ" ? "status-cancelled" : "status-confirmed";
    div.innerHTML = `
      <div>
        <p><strong>${r.name}</strong>ï½œ${r.route}</p>
        <p class="text-sm text-gray-500">${r.date}</p>
      </div>
      <div class="flex gap-2 items-center">
        <span class="status-tag ${statusClass}">${r.status}</span>
        ${
          userRole === "admin" && r.status !== "å·²å–æ¶ˆ"
          ? `<button class="bg-red-500 text-white px-3 py-1 rounded cancel-btn" data-idx="${i}">å–æ¶ˆ</button>` 
          : ""
        }
      </div>`;
    list.appendChild(div);
  });

  document.querySelectorAll(".cancel-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const idx = btn.dataset.idx;
      demoReservations[idx].status = "å·²å–æ¶ˆ";
      renderReservations();
      showToast(`å·²å–æ¶ˆ ${demoReservations[idx].name} çš„é ç´„`);
    });
  });
}

// ğŸ”„ åˆ‡æ›é é¢
document.querySelectorAll("nav button[data-target]").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    loadSection(btn.dataset.target);
  });
});
function loadSection(target){
  document.querySelectorAll("section").forEach(sec=>sec.classList.add("hidden"));
  document.getElementById(target).classList.remove("hidden");
  if(target === "reservations") renderReservations();
}

// ğŸ’¾ å„²å­˜è¨­å®š
document.getElementById("saveConfig").addEventListener("click",()=>{
  const announcement = document.getElementById("announcement").value;
  localStorage.setItem("announcement", announcement);
  showToast("âœ… è¨­å®šå·²å„²å­˜");
});

// ğŸ”” æç¤º
function showToast(msg){
  const div = document.createElement("div");
  div.className = "toast";
  div.textContent = msg;
  document.body.appendChild(div);
  setTimeout(()=>div.remove(),2500);
}

// å•Ÿå‹• LIFF
init();
</script>
</body>
</html>
