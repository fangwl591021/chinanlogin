<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>穿山甲專車註冊</title>
</head>
<body style="text-align:center;padding:40px;font-family:sans-serif">
<h2>會員註冊</h2>
<p>請填寫以下資料以完成註冊</p>
<div>
  <input id="name" placeholder="姓名"><br><br>
  <input id="phone" placeholder="電話"><br><br>
  <input id="sid" placeholder="學號"><br><br>
  <input id="dept" placeholder="科系"><br><br>
  <button onclick="submitForm()">送出註冊</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbySkPFla27wiTCS6g7KlgbiHIQOBl7dvgosG-qgq8aS_Y4mVpXIYzMG4EGp_i1-m7XQkw/exec";

async function submitForm() {
  const userData = JSON.parse(sessionStorage.getItem("userData"));
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const sid = document.getElementById("sid").value.trim();
  const dept = document.getElementById("dept").value.trim();
  if (!name || !phone || !sid || !dept) return alert("請完整填寫！");

  const body = {
    action: "registerUser",
    data: {
      userId: userData.userId,
      name, phone, sid, dept,
      registerTime: new Date().toISOString()
    }
  };

  const res = await fetch(SCRIPT_URL, {
    method: "POST", headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  });
  const result = await res.json();
  if (result.success) {
    userData.isRegistered = true;
    userData.phone = phone;
    userData.schoolId = sid;
    userData.dept = dept;
    userData.displayName = name;
    sessionStorage.setItem("userData", JSON.stringify(userData));
    alert("註冊成功！");
    location.href = "main.html";
  } else {
    alert("註冊失敗：" + result.message);
  }
}
</script>
</body>
</html>
