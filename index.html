<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ç©¿å±±ç”²å°ˆè»Šæœƒå“¡è¨»å†Š</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body{background:#000;color:#fff;text-align:center;font-family:"Microsoft JhengHei";margin:0;padding:20px}
input,button{width:80%;max-width:320px;margin:12px auto;display:block;padding:10px;border:none;border-radius:6px;font-size:1em}
input{background:#222;color:#fff}
button{background:#28a745;color:#fff;cursor:pointer;font-weight:bold}
#msg{margin:16px 0;font-size:1.1em}
.success{color:#00ff99}.warning{color:#ffcc00}.error{color:#ff4444}
</style>
</head>
<body>
<h2>ğŸšŒ ç©¿å±±ç”²å°ˆè»Šæœƒå“¡è¨»å†Š</h2>
<div id="msg"></div>
<div id="form" style="display:none">
  <input id="name" placeholder="å§“å">
  <input id="phone" placeholder="é›»è©±">
  <input id="schoolId" placeholder="å­¸è™Ÿ">
  <input id="dept" placeholder="ç§‘ç³»">
  <button id="submitBtn">é€å‡ºè¨»å†Š</button>
</div>

<script>
const LIFF_ID = '2008231249-yv8294Jp';
let UID='',NAME='';

window.onload = async()=>{
  await liff.init({liffId:LIFF_ID});
  if(!liff.isLoggedIn()) return liff.login();
  const profile=await liff.getProfile();
  UID=profile.userId; NAME=profile.displayName;
  showMsg(`ğŸ‘‹ æ­¡è¿ ${NAME}ï¼Œæ­£åœ¨æª¢æŸ¥èº«åˆ†...`,'warning');
  google.script.run.withSuccessHandler(res=>{
    if(res.isRegistered){
      showMsg(`âœ… æ­¡è¿å›ä¾† ${res.user.name}ï¼Œå‰å¾€é ç´„é ...`,'success');
      setTimeout(()=>location.href=`?uid=${UID}`,1500);
    }else{
      document.getElementById('form').style.display='block';
      showMsg('è«‹å®Œæˆè¨»å†Š','warning');
    }
  }).checkUserLogin(UID);
};

document.getElementById('submitBtn').onclick=()=>{
  const d={
    action:'registerUser',
    lineUserId:UID,
    name:val('name'),
    phone:val('phone'),
    schoolId:val('schoolId'),
    dept:val('dept')
  };
  if(!d.name||!d.phone||!d.schoolId||!d.dept){alert('è«‹å®Œæ•´å¡«å¯«');return;}
  google.script.run.withSuccessHandler(r=>{
    showMsg('âœ… è¨»å†ŠæˆåŠŸï¼å‰å¾€é ç´„é ','success');
    setTimeout(()=>location.href=`?uid=${UID}`,1500);
  }).registerUser(d);
};

function val(id){return document.getElementById(id).value.trim();}
function showMsg(t,c){document.getElementById('msg').innerHTML=`<span class="${c}">${t}</span>`;}
</script>
</body>
</html>
