<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>穿山甲專車</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.1/sdk.js"></script>
</head>
<body>
    <div id="app" style="text-align: center; padding: 50px 20px;">
        <h1>🚐 穿山甲專車</h1>
        <p>載入中...</p>
    </div>

    <script>
        const LIFF_ID = '2008231249-yv8294Jp';
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxgLRcFkyj9huPKqldaEendFC1YiGkdMSJvWi8qjvUAvbZgEs3OLjz9J5ZZCVvLW03gtw/exec';

        async function initializeApp() {
            try {
                await liff.init({ liffId: LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // 取得使用者資料並檢查註冊狀態
                const profile = await liff.getProfile();
                
                const response = await fetch(`${GAS_URL}?action=register&userId=${profile.userId}&name=${encodeURIComponent(profile.displayName)}`);
                const data = await response.json();
                
                if (data.status === 'existing_user') {
                    // 已註冊，跳轉到預約頁面
                    window.location.href = 'booking.html';
                } else {
                    // 未註冊，跳轉到註冊頁面
                    window.location.href = 'register.html';
                }
                
            } catch (error) {
                console.error('初始化失敗:', error);
                document.getElementById('app').innerHTML = `
                    <h1>錯誤</h1>
                    <p>系統初始化失敗，請重新整理</p>
                    <button onclick="location.reload()">重新整理</button>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
