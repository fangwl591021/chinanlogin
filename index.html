<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ç©¿å±±ç”²å°ˆè»Š</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      background:#000;
      color:#fff;
      text-align:center;
      font-family:"Microsoft JhengHei";
      margin:0; padding:0;
    }
    h1 { color:gold; margin:24px 0; }
    button {
      width:80%; max-width:320px;
      margin:12px auto;
      display:block;
      padding:10px;
      font-size:1em;
      border:none;
      border-radius:6px;
      background:#28a745; color:#fff;
      cursor:pointer;
    }
    #msg { margin:16px 0; font-size:1.1em; }
    .success { color:#00ff99; }
    .warning { color:#ffcc00; }
    .error { color:#ff4444; }
  </style>
</head>
<body>
  <h1>ğŸš ç©¿å±±ç”²å°ˆè»Š</h1>
  <div id="msg">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>

  <script>
    const CONFIG = {
      LIFF_ID: '2008231249-yv8294Jp',
      GAS_URL: 'https://script.google.com/macros/s/AKfycbxgLRcFkyj9huPKqldaEendFC1YiGkdMSJvWi8qjvUAvbZgEs3OLjz9J5ZZCVvLW03gtw/exec'
    };

    // ğŸ§© å…±ç”¨è¨Šæ¯é¡¯ç¤º
    function showMsg(text, type='') {
      const el = document.getElementById('msg');
      el.innerHTML = `<span class="${type}">${text}</span>`;
    }

    // ğŸš€ åˆå§‹åŒ–æµç¨‹
    async function init() {
      try {
        showMsg('âš™ï¸ æº–å‚™åˆå§‹åŒ– LIFF...', 'warning');
        await liff.init({ liffId: CONFIG.LIFF_ID });

        if (!liff.isLoggedIn()) {
          showMsg('ğŸ”‘ å°å‘ LINE ç™»å…¥ä¸­...', 'warning');
          liff.login({ redirectUri: window.location.href });
          return;
        }

        const profile = await liff.getProfile();
        showMsg(`ğŸ‘‹ æ­¡è¿ ${profile.displayName}`, 'success');

        // å‘¼å«å¾Œç«¯ç¢ºèªè¨»å†Šç‹€æ…‹
        const url = `${CONFIG.GAS_URL}?action=register&userId=${profile.userId}&name=${encodeURIComponent(profile.displayName)}`;
        const res = await fetch(url).then(r => r.json());

        if (res.status === 'existing_user') {
          showMsg('âœ… å·²è¨»å†Šï¼Œç”¨æˆ¶ç™»å…¥æˆåŠŸï¼', 'success');
          window.location.href = 'booking.html';
        } else {
          showMsg('ğŸ“ å°šæœªè¨»å†Šï¼Œå°å‘è¨»å†Šé ...', 'warning');
          window.location.href = 'register.html';
        }

      } catch (err) {
        console.error(err);
        showMsg('âŒ åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢<br>' + err.message, 'error');
      }
    }

    // ç­‰å¾… DOM æº–å‚™å®Œæˆå†åˆå§‹åŒ–ï¼ˆç¢ºä¿ SDK è¼‰å…¥æˆåŠŸï¼‰
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
