<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ç©¿å±±ç”²å°ˆè»Šç™»å…¥</title>
  <!-- âœ… ä½¿ç”¨æ˜ç¢ºç‰ˆæœ¬è™Ÿï¼Œé¿å… ORB -->
  <script src="https://static.line-scdn.net/liff/edge/2.20.2/sdk.js"></script>
  <style>
    body {
      font-family:"Microsoft JhengHei",system-ui;
      background:#000; color:#fff; text-align:center;
      margin:0; padding:40px 20px;
    }
    h1 { color:gold; margin-bottom:24px; }
    button {
      background:#28a745; color:#fff; border:none;
      border-radius:6px; padding:10px 24px;
      font-size:16px; cursor:pointer;
      margin-top:10px;
    }
    #msg { margin:16px auto; font-size:1.1em; width:90%; max-width:400px; }
    .error { color:#ff4444; }
    .success { color:#00ff99; }
    .warning { color:#ffcc00; }
  </style>
</head>
<body>
  <h1>ğŸš ç©¿å±±ç”²å°ˆè»Š</h1>
  <div id="msg">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>

  <script>
    const CONFIG = {
      LIFF_ID: '2008231249-yv8294Jp',
      GAS_URL: 'https://script.google.com/macros/s/AKfycbxgLRcFkyj9huPKqldaEendFC1YiGkdMSJvWi8qjvUAvbZgEs3OLjz9J5ZZCVvLW03gtw/exec'
    };

    function showMsg(text, type='') {
      const el = document.getElementById('msg');
      el.innerHTML = `<div class="${type}">${text}</div>`;
    }

    async function initLiff() {
      try {
        showMsg('âš™ï¸ åˆå§‹åŒ– LIFF ä¸­...', 'warning');
        await liff.init({ liffId: CONFIG.LIFF_ID });

        if (!liff.isLoggedIn()) {
          showMsg('ğŸ”‘ å‰å¾€ LINE ç™»å…¥é é¢...', 'warning');
          liff.login({ redirectUri: window.location.href });
          return;
        }

        const profile = await liff.getProfile();
        showMsg(`ğŸ‘‹ æ­¡è¿ ${profile.displayName}`, 'success');

        const url = `${CONFIG.GAS_URL}?action=register&userId=${profile.userId}&name=${encodeURIComponent(profile.displayName)}`;
        const res = await fetch(url).then(r => r.json());

        if (res.status === 'existing_user') {
          showMsg('âœ… å·²è¨»å†Šï¼Œå°å‘é ç´„é ...', 'success');
          window.location.href = 'booking.html';
        } else {
          showMsg('ğŸ“ å°šæœªè¨»å†Šï¼Œå°å‘è¨»å†Šé ...', 'warning');
          window.location.href = 'register.html';
        }

      } catch (err) {
        console.error('LIFF åˆå§‹åŒ–éŒ¯èª¤:', err);
        showMsg(`âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š${err.message}`, 'error');
      }
    }

    document.addEventListener('DOMContentLoaded', initLiff);
  </script>
</body>
</html>
